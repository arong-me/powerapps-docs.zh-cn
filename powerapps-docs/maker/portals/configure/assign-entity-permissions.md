---
title: 使用门户的实体权限添加基于记录的安全性 |MicrosoftDocs
description: 添加实体权限并向其分配 web 角色的说明。
author: sbmjais
manager: shujoshi
ms.service: powerapps
ms.topic: conceptual
ms.custom: ''
ms.date: 11/04/2019
ms.author: shjais
ms.reviewer: ''
ms.openlocfilehash: 47730a2ba169b89534fa93221290c5598a95a8e8
ms.sourcegitcommit: d9cecdd5a35279d78aa1b6c9fc642e36a4e4612c
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/04/2019
ms.locfileid: "73553385"
---
# <a name="add-record-based-security-by-using-entity-permissions-for-portals"></a>使用门户的实体权限添加基于记录的安全性

若要在门户中将基于记录的安全性应用于单个记录，请使用实体权限。 您可以向 web 角色添加实体权限，以便您可以在组织中定义与使用实体权限引入的记录所有权和访问权限的权限和概念相对应的角色。 请记住，给定联系人可以属于任意数量的角色，并且给定角色可以包含任意数量的实体权限。 [!INCLUDE[proc-more-information](../../../includes/proc-more-information.md)][为门户创建 web 角色](create-web-roles.md) 

尽管可以通过内容授权来授予门户网站映射中更改和访问 Url 的权限，但站点管理器还需要保护使用实体窗体和实体列表构建的自定义 web 应用程序。 [!INCLUDE[proc-more-information](../../../includes/proc-more-information.md)][定义实体窗体](entity-forms.md)并[定义实体列表](entity-lists.md)  

若要保护这些功能，实体权限允许向任意实体授予粒度权限，并允许通过关系定义启用记录级安全性。

## <a name="add-entity-permissions-to-a-web-role"></a>向 web 角色添加实体权限

1.  打开[门户管理应用](configure-portal.md)。

2. &gt; **Web 角色**中转到**门户**，并打开要向其添加权限的 web 角色。 

3. 选择 "**添加**" 可向 web 角色添加现有实体权限。 

4. 选择 "**新建**" 以创建新的实体权限记录。

    ![向 web 角色添加实体权限](../media/add-entity-permission-web-role.png "向 web 角色添加实体权限")  

创建新的实体权限记录时，第一步是确定将受到保护的实体。 下一步是定义范围（如下所述），并&mdash;全局&mdash;定义该作用域的关系。 最后，确定通过此权限授予角色的权限。 请注意，权限是累积性的，因此，如果用户所在的角色授予读取权限，而另一项授予读取和更新权限，则该用户将对这两个角色之间重叠的任何记录具有读取和更新权限。

> [!Note]
> 选择 "CMS" 实体（如网页和 web 文件）无效，并且可能会产生其他意想不到的后果。 门户将基于内容访问控制（而不是实体权限）来断言 CMS 实体的安全性。

### <a name="global-scope"></a>全局范围

如果对具有全局作用域的角色授予了具有读取权限的实体权限记录，该角色中的任何联系人都将有权访问已定义实体的所有记录。 例如，他们将能够查看所有潜在客户、所有帐户，等等。 任何实体列表都会自动遵从此权限，本质上是根据已为该列表定义的模型驱动应用视图显示所有记录。 此外，如果用户尝试通过他们无权访问的实体表单访问记录，他们将收到权限错误。

### <a name="contact-scope"></a>联系人范围

对于 "联系人范围"，为其定义权限记录的角色中已登录的用户将具有该权限授予的权限，该权限仅适用于通过定义的关系与该用户的联系人记录相关的记录。

在实体列表中，这意味着筛选器将添加到该列表所显示的任何模型驱动的应用视图中，后者仅检索直接链接到当前用户的记录。 （根据方案，可以将此关系视为所有权或管理权限。）

如果加载记录时存在此关系，实体窗体将只允许读取、创建、写入等适当的权限。 [!INCLUDE[proc-more-information](../../../includes/proc-more-information.md)][在门户中定义实体窗体和自定义逻辑](entity-forms.md)。  

### <a name="account-scope"></a>帐户范围

使用帐户范围，为其定义权限记录的角色中已登录的用户将具有该权限授予的权限，该权限仅适用于通过定义的关系与该用户的父帐户记录相关的记录。

### <a name="self-scope"></a>己方范围

己方范围允许您定义用户对其自身的联系人（标识）记录的权限。 这允许用户使用实体窗体或 web 窗体更改其自己的联系人记录，并将其配置文件与其关联。 请注意，"默认配置文件" 页提供了一个特殊的内置窗体，允许任何用户更改其基本联系人信息，以及选择加入或退出市场营销列表。 如果此窗体包含在门户中（默认情况下），用户将不需要此权限即可使用它。 但是，他们将需要此权限才能使用任何面向其用户联系人记录的自定义实体窗体或 web 窗体。

### <a name="parental-scope"></a>父范围

在这种最复杂的情况下，将为实体提供权限，而该实体是已为其定义实体权限记录的实体的关系。 此权限实际上为父实体权限的子记录。

父权限记录定义实体的权限和作用域（可能是全局范围或联系人范围），但也可以使用父权限。 该实体可能与联系人相关（对于联系人范围）或全局定义。 使用该权限后，将创建一个子权限，该权限定义了从另一个实体到在父关系中定义的实体的关系。

因此，有权访问由父实体权限定义的记录的 web 角色中的用户还将具有对子权限记录为与父记录相关的记录所定义的权限。

### <a name="attributes-and-relationships"></a>特性和关系

下表说明了实体权限特性。

| 名称                     | 描述                                                                                                                                                                                                                                                                                                               |
|--------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 名称                     | 记录的描述性名称。 此字段是必需的。                                                                                                                                                                                                                                                               |
| 实体名称              | 要保护的实体的逻辑名称，或者将定义联系人关系或父关系以保护子权限上相关实体的逻辑名称。 此字段是必需的。                                                                                                                        |
| 范围（必需）                   | <ul><li>**Global**：向实体记录授予权限，而不需要所有者（联系人）的任何要求。</li><li>**Contact**：向与所有者（联系人）具有直接关系的实体记录授予权限。</li><li>**帐户**：向与某个帐户有关系的实体记录授予权限，此权限充当该帐户的所有者，假设该帐户是该联系人的父客户。</li><li>**Parent**：通过其父权限的关系链向实体记录授予权限。</li></ul>|
| 联系人关系     | 仅当 Scope = Contact 时才是必需的。 实体名称字段指定的联系人和实体之间的关系的架构名称。|
| 父关系      | 仅当分配了父实体权限时才是必需的。 实体名称字段指定的实体与父实体权限记录上的实体名称字段指定的实体之间的关系的架构名称。                                                                                     |
| 父实体权限 | 仅在 Scope = Parent 时是必需的。                                                                                                                                                                                                                                                            |
| 读取                     | 控制用户是否可以读取记录的特权。                                                                                                                                                                                                                                                               |
| 写入                    | 控制用户是否可以更新记录的特权。                                                                                                                                                                                                                                                             |
| 创建                   | 控制用户是否可以创建新记录的特权。 为实体类型创建记录的权限不适用于单个记录，而是应用于实体的类。                                                                                                                             |
| Delete                   | 控制用户是否可以删除记录的特权。                                                                                                                                                                                                                                                             |
| 附加                   | 控制用户是否可以将其他记录附加到指定记录的特权。"追加" 和 "追加到访问权限" 结合使用。 用户每次将一个记录附加到另一个记录时，都必须具有两个权限。 例如，当您将便笺附加到案例时，您必须对便笺使用 "追加访问权限"，并在操作工作时对 "追加到" 访问权限。  |
| 追加到                | 控制用户是否可以将有问题的记录追加到其他记录的特权。"追加" 和 "追加到访问权限" 结合使用。 有关详细信息，请参阅 Append 的说明。|
| | |

## <a name="global-permissions-for-tasks-related-to-leads"></a>与潜在客户相关的任务的全局权限

在一个方案中，我们可能希望使用实体列表和实体窗体将门户中的所有潜在顾客呈现给自定义的主管经理 web 角色中的任何人。 在 "潜在顾客" 编辑窗体上，每当在列表中选择了 "潜在顾客" 行时，子网格将显示相关的任务记录。 领导管理员角色中的任何人都应该可以访问这些记录。 作为第一步，我们将为主管主管角色中的任何人授予全局权限。

此角色具有 "潜在顾客" 实体的相关实体权限，具有全局作用域。

此角色中的用户可以通过门户上的实体列表或窗体访问所有潜在顾客。

![向潜在客户授予全局权限](../media/grant-global-permission-leads.png "向潜在客户授予全局权限")  

现在，我们会将一个子权限添加到全局组长权限。 打开父权限记录后，请访问**子实体权限子**网格，选择 "**新建**" 打开实体权限查找，选择放大镜，然后选择 "**新建**" 以添加新记录。

![向 web 角色添加实体权限](../media/add-entity-permission-web-role.png "向 web 角色添加实体权限")  

选择实体作为任务，并选择 "作用域" 作为家长。 请注意，您可以选择 "父关系" （"**潜在顾客\_任务**"）。 此权限意味着，位于具有父权限的 web 角色中的联系人将对与潜在客户相关的所有任务具有全局权限。

请记住，为了使您的列表遵守这些权限，您必须对列表启用了实体权限，并且必须有一些操作确实允许用户执行其权限已被授予的操作。 此外，还必须对[实体窗体](entity-forms.md)记录启用权限，并且必须为要使用子权限启用的实体（在此情况下为任务）为要启用子权限的实体呈现具有子网格的页面。 而且，若要对任务启用 "读取" 或 "创建" 权限，则还需要配置这些实体窗体，并编辑窗体以删除 "相关查找" 字段。  

![编辑网页窗体](../media/edit-webpage-form.png "编辑网页窗体")  

然后，为与潜在客户相关的所有任务授予权限。 如果在实体列表中显示任务，则筛选器实质上将添加到列表中，以便只有与潜在客户相关的任务才会显示在列表中。 在我们的示例中，它们是使用实体窗体上的子网格来呈现的。

![任务示例](../media/tasks-example.png "任务示例")  

## <a name="contact-scoped-permissions-for-tasks"></a>任务的联系人范围权限

另一个示例是，如果你希望允许访问联系人与该任务的父主管相关的任务。 此方案与上一节几乎完全相同，但在这种情况下，父权限的作用域为 "联系人"，而不是 "全局"。 必须对 "潜在顾客" 实体和 "联系人" 实体之间的父关系指定关系。

设置这些权限后，"领导经理" 角色中的用户可以直接访问与联系人范围权限指定相关的潜在客户，并访问与子权限记录指定的相同 lead 相关的任务。

### <a name="see-also"></a>另请参阅

[为门户创建 web 角色](create-web-roles.md)  
[控制门户的网页访问](webpage-access-control.md)