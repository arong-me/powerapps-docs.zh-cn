---
title: 使用实体权限为门户添加基于记录的安全性 | MicrosoftDocs
description: 有关如何添加实体权限并为其分派 Web 角色的说明。
author: tapanm-msft
manager: kvivek
ms.service: powerapps
ms.topic: conceptual
ms.custom: ''
ms.date: 11/04/2019
ms.author: tapanm
ms.reviewer: ''
ms.openlocfilehash: 082ed3fe584c9812482928c2c1d9a67d9690a569
ms.sourcegitcommit: a0d069f63d2ce9496d578f81e65cd32bec2faa4d
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 01/23/2020
ms.locfileid: "2979501"
---
# <a name="add-record-based-security-by-using-entity-permissions-for-portals"></a>使用实体权限为门户添加基于记录的安全性

若要将门户中基于记录的安全性应用于单个记录，请使用实体权限。 可向 Web 角色添加实体权限，以便定义组织中的角色，这些角色在逻辑上对应于使用实体权限引入的记录所有权和访问权限的权限和概念。 请记住，特定联系人可以属于任意数量的角色，并且特定角色可以包含任意数量的实体权限。 [!INCLUDE[proc-more-information](../../../includes/proc-more-information.md)] [为门户创建 Web 角色](create-web-roles.md) 

虽然通过内容授权授予了在门户站点地图中更改和访问 URL 的权限，但是站点管理员还希望保护其使用实体窗体和实体列表构建的自定义 Web 应用程序。 [!INCLUDE[proc-more-information](../../../includes/proc-more-information.md)] [定义实体窗体](entity-forms.md)和[定义实体列表](entity-lists.md)  

为了保护这些功能，实体权限允许为任意实体授予细粒度权限，以及通过关系定义实现记录级别安全性。

## <a name="add-entity-permissions-to-a-web-role"></a>将实体权限添加到 Web 角色

1.  打开[“门户管理”应用](configure-portal.md)。

2. 转到**门户** &gt; **Web 角色**，然后打开要向其添加权限的 Web 角色。 

3. 在**相关**下，选择**实体权限**。

4. 选择**添加现有实体权限**将现有实体权限添加到 Web 角色。 

4. 浏览实体权限或选择**新建实体权限**以创建新的实体权限记录。

    ![将实体权限添加到 Web 角色](../media/add-entity-permission-web-role.png "将实体权限添加到 Web 角色")  

创建新的实体权限记录时，第一步是确定要保证安全的实体。 下一步是定义范围（如下所述），对于 &mdash;范围是除全局以外的任何值&mdash;，则指定用于定义该范围的关系。 最后，确定通过此权限授予角色的权限。 请注意，权限具有累积性，因此，如果用户处于已授予读取权限的一种角色，也处于已授予读取和更新权限的另一种角色，则该用户将对两个角色之间重叠的对象具有读取和更新权限。

> [!Note]
> 选择网页和 Web 文件之类 CMS 实体无效，可能产生其他意外后果。 门户将根据内容访问控件而不是实体权限断言 CMS 实体的安全。

### <a name="global-scope"></a>全局范围

如果将具有读取权限的实体权限记录授予具有全局范围的角色，则该角色中任何联系人都将能够访问已定义实体的所有记录。 例如，他们将可以查看所有潜在顾客、所有客户等。 所有实体列表将自动遵循此权限；基本上根据为该列表定义的模型驱动应用视图显示所有记录。 此外，如果用户试图通过他们没有访问权限的实体窗体访问记录，他们将收到错误。

### <a name="contact-scope"></a>联系人范围

使用联系人范围，拥有已定义权限记录的角色的登录用户将拥有该权限授予的权限，但仅适用于通过定义的关系与该用户的联系人记录关联的记录。

在实体列表中，这意味着将向该列表显示的任何模型驱动应用视图添加筛选器，用于仅检索直接链接到当前用户的记录。 （根据场景，可将此关系视为所有权或管理权。）

如果加载记录时此关系已存在，则实体窗体仅允许相应的“读取”、“创建”、“写入”等权限。 [!INCLUDE[proc-more-information](../../../includes/proc-more-information.md)] [定义实体窗体](entity-forms.md)。  

### <a name="account-scope"></a>帐户范围

使用帐户范围，拥有已定义权限记录的角色的登录用户将拥有该权限授予的权限，但仅适用于通过定义的关系与该用户的父帐户记录关联的记录。

### <a name="self-scope"></a>自范围

自范围允许您定义用户对其自己的联系人（身份）记录拥有的权限。 这允许用户使用实体窗体或 Web 窗体对与他们的配置文件链接的联系人记录进行更改。 请注意，默认“配置文件”页面具有特殊的内置窗体，允许任何用户更改其基本联系人信息以及加入和退出市场营销列表。 如果您的门户中包括此窗体（默认设置），则用户无需此权限便可使用它。 但是，他们需要此权限才能使用面向其用户联系人记录的任何自定义实体窗体或 Web 窗体。

### <a name="parental-scope"></a>父范围

在最复杂的情况下，授予的实体权限是已定义实体权限记录的实体以外的关系。 此权限实际上是父实体权限的子记录。

父权限记录定义实体的权限和范围（可能是全局或联系人范围，但父项也是可能的）。 该实体可能与联系人相关（使用联系人范围时）或是全局定义的。 使用该权限时，将创建子权限，用于定义父关系中定义另一个实体与该实体之间的关系。

因此，如果用户具有的 Web 角色有权访问父实体权限定义的记录，则该用户也拥有与父记录相关的子权限记录定义的权限。

### <a name="attributes-and-relationships"></a>属性和关系

下表介绍实体权限属性。

| 姓名                     | 说明                                                                                                                                                                                                                                                                                                               |
|--------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 姓名                     | 记录的描述性名称。 此字段为必填字段。                                                                                                                                                                                                                                                               |
| 实体名称              | 要保护的实体的逻辑名称，或为了保护子权限上相关实体而定义联系人关系或父关系的实体的逻辑名称。 此字段为必填字段。                                                                                                                        |
| 范围（必需）                   | <ul><li>**全局**：向没有任何负责人（联系人）要求的实体记录授予权限。</li><li>**联系人**：向与负责人（联系人）具有直接关系的实体记录授予权限。</li><li>**客户**：向与某个客户（作为负责人）具有关系的实体记录授予权限，假定该客户是联系人的上级客户。</li><li>**父**：通过父权限的关系向实体记录授予权限。</li></ul>|
| 联系人关系     | 仅在“范围 = 联系人”时需要。 联系人与“实体名称”字段指定的实体之间的关系的架构名称。|
| 父关系      | 仅在分派父实体权限时需要。 “实体名称”字段指定的实体与其父实体权限记录上的“实体名称”字段指定的实体之间的关系的架构名称。                                                                                     |
| 父实体权限 | 仅在“范围 = 父”时需要。                                                                                                                                                                                                                                                            |
| 读取                     | 用于控制用户是否可以读取记录的特权。                                                                                                                                                                                                                                                               |
| 写                    | 用于控制用户是否可以更新记录的特权。                                                                                                                                                                                                                                                             |
| 创建​​                   | 用于控制用户是否可以创建新记录的特权。 用于为实体类型创建记录的权限不适用于单条记录，而适用于实体类。                                                                                                                             |
| 删除键                   | 用于控制用户是否可以删除记录的特权。                                                                                                                                                                                                                                                             |
| 追加                   | 用于控制用户是否可以向指定记录再附加一条记录的权限。“追加”和“追加到”访问权限可以一起使用。 用户每次将一条记录附加到另一条记录时，都必须同时具有这两种权限。 例如，在向案例附加注释时，您必须对注释具有“追加”访问权限，并且对案例具有“追加到”访问权限才能执行此操作。  |
| 追加到                | 用于控制用户是否可以将讨论的记录追加到另一条记录的权限。“追加”和“追加到”访问权限可以一起使用。 有关详细信息，请参阅追加的说明。|
| | |

## <a name="global-permissions-for-tasks-related-to-leads"></a>与潜在顾客相关的任务的全局权限

在一种方案中，可能想要使用实体列表和实体窗体在门户上为自定义“潜在顾客经理”Web 角色中的所有人呈现所有潜在顾客。 在“潜在顾客编辑”窗体上（在列表上选择潜在顾客行便会启动该窗体），子网格将显示相关任务记录。 潜在顾客管理员角色中的任何人均可访问这些记录。 第一步，我们将为潜在顾客管理员角色中的任何人指定对潜在顾客的全局权限。

此角色具有与使用全局范围的潜在顾客实体相关的实体权限。

具有此角色的用户可以通过门户上的实体列表或窗体访问所有潜在顾客。

![向潜在顾客授予全局权限](../media/grant-global-permission-leads.png "向潜在顾客授予全局权限")  

我们现在将子权限添加到全局潜在顾客权限。 打开父权限记录时，请转至**子实体权限**子网格，选择**新建**以打开实体权限的查找，选择放大镜，然后选择**新建**以添加新记录。

![将实体权限添加到 Web 角色](../media/add-entity-permission-web-role.png "将实体权限添加到 Web 角色")  

选择实体作为任务，并选择范围作为“父”。 请注意，随后您可以选择父关系 (**Lead\_Tasks**)。 此权限表示，Web 角色中具有父权限的联系人将对与潜在顾客相关的所有任务具有全局权限。

请记住，为了让您的列表遵循这些权限，则必须在列表上启用实体权限，并且必须具有实际上允许用户执行已授予权限操作的操作。 此外，还必须在[实体窗体](entity-forms.md)记录上启用权限，并且该窗体必须呈现在页面中，对于要启用子权限的实体，该窗体上还有一个子网格（在此案例中为“任务”）。 此外，若要为任务启用读取或创建权限，则还需要配置这些实体窗体，并编辑窗体以移除相关查找字段。  

![编辑网页窗体](../media/edit-webpage-form.png "编辑网页窗体")  

这会为与潜在顾客相关的所有任务授予权限。 如果任务显示在实体列表上，则需要将筛选器添加到列表，以便仅在列表中显示与潜在顾客相关的任务。 在我们的示例中，这些任务使用子网格显示在实体窗体上。

![任务示例](../media/tasks-example.png "任务示例")  

## <a name="contact-scoped-permissions-for-tasks"></a>任务的联系人范围内权限

另一个示例是，如果您允许访问联系人与该任务的父级潜在顾客相关的任务。 此情形与上一节几乎完全相同，只是在此情况下，父权限的范围是“联系人”而不是全局。 必须在父关系上指定潜在顾客实体与联系人实体之间的关系。

授予这些权限之后，潜在顾客管理员角色中的用户可以访问由联系人范围权限指定并且与他们直接相关的潜在顾客，以及由子权限记录指定并且与相同潜在顾客相关的访问任务。

### <a name="see-also"></a>另请参阅

[为门户创建 Web 角色](create-web-roles.md)  
[控制门户的网页访问](webpage-access-control.md)