---
title: 定义实体窗体 |MicrosoftDocs
description: 在门户中创建实体窗体的说明。
author: sbmjais
manager: shujoshi
ms.service: powerapps
ms.topic: conceptual
ms.custom: ''
ms.date: 11/04/2019
ms.author: shjais
ms.reviewer: ''
ms.openlocfilehash: 79e6f02f9a13f1c828efe5c472d267e707b09576
ms.sourcegitcommit: d9cecdd5a35279d78aa1b6c9fc642e36a4e4612c
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/04/2019
ms.locfileid: "73552695"
---
# <a name="about-entity-forms"></a>关于实体窗体

一种数据驱动配置，允许最终用户在门户中添加一个用于收集数据的窗体，而无需开发人员在门户中显示窗体，实体窗体是在 Common Data service 中创建的，然后放入门户中的网页中，或与 w 结合使用第 i subgrids 和实体列表，用来构建完整的 web 应用程序。 [有关实体列表](entity-lists.md)的 [!INCLUDE[proc-more-information](../../../includes/proc-more-information.md)] 

![联系我们窗体](../media/contact-us-form.png "联系我们窗体")  

## <a name="add-a-form-to-your-portal"></a>将窗体添加到门户

实体窗体包含与网页的关系，以及用于控制门户内窗体初始化的其他属性。 与网页的关系允许动态检索网站中给定页面节点的窗体定义。 

若要查看现有实体窗体或创建新的实体窗体，请打开[门户管理应用](configure-portal.md)，并 &gt;**实体窗体**中转到**门户**。

在创建新的实体窗体时，第一步是确定将呈现的**实体**和**窗体名称**，以及**模式： "插入"、"编辑" 或 "只读**"。 所选模式将确定是从门户创建新记录、编辑现有记录还是仅在门户上显示有关记录的信息。

> [!Note]
> - **实体窗体**必须与给定网站的网页相关联，才能在站点内查看该窗体。
> - 实体窗体中不支持连接实体 subgrids。 如果使用窗体设计器将连接实体子网格添加到窗体，则在门户中呈现窗体并使用连接实体时，会显示错误消息。
> - 实体窗体中不支持重复字段、多选选项集、自定义控件和业务规则。
> - 业务规则和客户端 API 可以在只读窗体上启用锁定的字段。
> - 如果在插入模式下创建实体窗体，则不能更改按钮的对齐方式，也不能将操作按钮置于实体窗体之上。
> - 如果将查找控件呈现为窗体上的下拉列表，则相关记录筛选器将不起作用。

可以通过在最左侧的菜单中选择**相关**导航链接中列出的 "**网页**" 链接来查看与实体表单关联的网页。

创建或编辑网页时，可以在网页窗体上提供的 "查找" 字段中指定**实体窗体**。

门户使用的各个母版页都包含**EntityForm**服务器控件的声明。 当呈现包含 Page （~/Pages/Page.aspx）页模板或 Full Page （~/Pages/FullPage.aspx）页模板的网页时，这些控件将确定实体窗体查找是否包含一个值，在这种情况下，将呈现窗体。

## <a name="secure-your-forms"></a>保护窗体

若要保护窗体，必须创建实体权限，以根据 web 角色确定记录的访问权限和所有权。 如果用户落在某个实体窗体上并且没有权限，则他们将收到一条错误消息。 若要启用实体窗体的权限，请将 "**启用实体权限**" 设置为 "true"。 [!INCLUDE[proc-more-information](../../../includes/proc-more-information.md)][为门户创建 web 角色](create-web-roles.md)。  

## <a name="entity-form-attributes-and-relationships"></a>实体窗体属性和关系

|名称|描述|
|-----|----------|
|名称|记录的描述性名称。 此字段是必需的。|
|实体名称|从中加载窗体的实体的名称。 此字段是必需的。|
|窗体名称| 要呈现的目标实体上的窗体的名称。 此字段是必需的。|
|选项卡名称|  窗体上要呈现的指定实体的选项卡的可选名称。|
|模式|以下值之一：<ul><li>&</li><li>编辑</li><li>只读</li></ul>选择 "_插入_" 指示窗体应该在提交时插入新记录。 指定 "_编辑_" 指示窗体应该编辑现有记录。 选择 "_只读_" 指示窗体应显示现有记录的不可编辑窗体。 _编辑_和_只读_要求源记录存在，而 "记录源类型" 和 "记录 ID 查询字符串参数名称" 字段中指定的参数用于在门户中加载窗体时选择适当的记录。|
|记录源类型|以下值之一：<ul><li>查询字符串</li><li>当前门户用户</li><li>与当前门户用户关联的记录</li></ul>选择_查询字符串_需要参数名称，该名称必须在表单的 URL 的查询字符串中提供。 这可以在 "记录 ID 查询字符串参数名称" 字段中指定。<br>选择 "_当前门户用户_" 将检索当前已经过身份验证的用户的门户用户记录。<br>选择_与当前门户用户关联的记录_将检索当前已通过身份验证的用户的门户用户记录，然后检索 "关系名称" 字段指定的给定关系的记录。|
|记录 ID 查询字符串参数名称| 在包含此实体窗体的网页的 URL 的查询字符串中提供的参数名称。|
|关系名称| 当记录源类型为与当前门户用户相关联的记录时是必需的。 当前门户用户记录与目标记录之间的关系的逻辑名称。 这必须返回实体名称字段指定的相同实体类型。|
|如果为 Null，则允许创建|  一个可选的布尔值，当记录源类型为与当前门户用户相关联的记录时可用。 指示如果相关记录不存在，则允许用户第一次创建该记录，否则，如果该记录不存在，则会引发异常，因为窗体需要数据绑定到记录。|
|启用实体权限| 将使窗体与实体权限相关。 出于向后兼容的原因，默认值为 false。 如果设置为 true，则任何需要访问窗体的用户都必须具有显式权限。|
|||

### <a name="form-options"></a>表单选项

|名称|描述|
|----|---------|
|添加 Captcha|   显示 captcha。|
|为经过身份验证的用户显示 Captcha|  为经过身份验证的用户显示 captcha。|
|验证组|  分配给用于计算命名组的有效输入的输入控件的组名。|
|自动从选项卡生成步骤| 指示实体窗体上的多个选项卡将与每个选项卡一起显示，每个选项卡都作为从第一个选项卡开始的顺序步骤，并继续直到导航到所有选项卡，并在最终提交时插入记录。 默认情况下，不选择此选项。 默认值指示只为当前步骤呈现一个选项卡或窗体。 如果未指定选项卡名称，则显示第一个选项卡。|
|以内联方式呈现 Web 资源|   消除了包含实体窗体中的 web 资源的 iframe。|
|已启用工具提示|  工具提示是使用目标实体上特性的说明设置的。|
|显示不支持的字段|   当前支持所有字段。 这是为 Common Data Service 可能对字段类型进行的可能更改而保留的。|
|根据需要设置建议字段|    使要求的字段要求级别设置为 "业务建议" 的所有属性。|
|使所有字段都是必需的|  使所有字段都是必需的，而不考虑字段要求级别。|
|验证摘要 CSS 类|  分配给验证摘要的 CSS 类名。 默认值为 "验证-摘要警报警报-错误警报-块"|
|启用验证摘要链接|   True 或 false 的布尔值，指示是否应在验证摘要中呈现定位点链接以滚动到包含错误的字段。 默认值为 true。|
|验证摘要链接文本|  分配给验证摘要链接的标签。 默认值为 "单击此处"。|
|验证摘要标题文本|    分配给验证摘要标头的标签。|
|说明|  使用窗体的说明。|
|找不到记录消息|  找不到记录时要显示的消息。|
|||

### <a name="on-success-settings"></a>成功时设置

|名称|描述|
|----|----------|
|成功时|    以下值之一：<ul><li>显示成功消息（默认值）</li><li>定向</li></ul>|
|成功时隐藏窗体|  需要成功设置才能显示成功消息。 如果选择此选项，则在成功提交窗体后将隐藏窗体。|
|成功消息|   需要成功设置才能显示成功消息。 提交成功后向用户显示的消息。 如果未指定，则将显示 "默认消息（已成功完成提交"）。 对于为组织安装和启用的每个语言包，都可以使用字段以关联的语言输入消息。|
|外部 URL|在成功设置重定向时要求。 指定指向 web 上的外部资源的 URL。
|或网页|在成功设置重定向时要求。 选择当前网站中的网页。|
|追加现有查询字符串|  在成功设置重定向时要求。 如果选择此选项，将在重定向之前将现有查询字符串参数添加到目标 URL。|
|将记录 ID 追加到查询字符串|  在成功设置重定向时要求。 如果选择此选项，则所创建的记录的 ID 将追加到正在重定向到的 URL 的查询字符串中。|
|记录 ID 查询字符串参数名称|     在成功设置重定向时要求。 要重定向到的 URL 的查询字符串中的 ID 参数的名称。|
|追加自定义查询字符串|    在成功设置重定向时要求。 可追加到重定向 URL 的现有查询字符串的自定义字符串。|
|将属性值追加到查询字符串参数名称|   在成功设置重定向时要求。 要给予参数的名称，该参数与附加到重定向 URL 的查询字符串的目标实体上的属性值关联。|
|将属性值追加到查询字符串-属性逻辑名称|在成功设置重定向时要求。 目标实体上的属性的逻辑名称，用于获取要追加到重定向 URL 的查询字符串的值。|
|||

### <a name="additional-settings"></a>其他设置

|名称|描述|
|----|----------|
|关联当前门户用户| 指示当前已登录用户的记录应与目标实体记录相关联。|
|目标实体门户用户查找属性|    存储门户用户的目标实体上的属性的逻辑名称。|
|是活动方| 指示目标实体门户用户查找属性是否为活动方类型的布尔值。|
|附加文件|   选中此选项可让窗体在窗体底部包含 "文件上传" 控件，以允许将文件附加到记录。|
|附加文件存储位置|  选项：笔记附件、Azure Blob 存储。 如果你的组织配置为使用 Azure 存储，则可以选择在此处为此实体窗体存储上载的文件。 否则，文件会存储为备注附件。|
|允许多个文件|布尔值，指示用户是否可以上传多个文件。|
|接受|    Accept 特性指定服务器通过文件上传接受的文件 MIME 类型。 若要指定多个值，请用逗号（如音频/ *、视频/* 、图像/*）分隔值。|
|标签| 显示在文件上传控件旁边的文本。 对于为组织安装和启用的每个语言包，都可以使用字段以关联的语言输入消息。|
|需要附加文件| 使文件的附件继续进行。|
|必需的错误消息|如果需要，在窗体验证过程中显示的消息为 true，并且用户尚未附加文件。 对于为组织安装和启用的每个语言包，都可以使用字段以关联的语言输入消息。|
|将文件限制为接受的类型|  强制对 Accept 字段进行验证。 如果未选择此选项，则 Accept 属性将仅用作文件上传对话框的建议。|
|文件类型错误消息|如果将文件限制为接受的类型为 true，并且用户试图上传无效的文件类型，则在窗体验证过程中显示的消息。 对于为组织安装和启用的每个语言包，都可以使用字段以关联的语言输入消息。|
|最大文件大小（kb）|  强制验证最大允许的上载文件大小。|
|文件大小错误消息|   如果最大文件大小（以 kb 为单位）为 true，并且用户已尝试上传太大的文件，则在窗体验证过程中显示的消息。 对于为组织安装和启用的每个语言包，都可以使用字段以关联的语言输入消息。|
|自定义 JavaScript| JavaScript 的自定义块，将添加到页面底部，紧靠在结束窗体标记元素之前。 实体字段的 HTML 输入 id 设置为属性的逻辑名称。 这使得可以使用 jQuery 轻松选择字段、设置值或其他客户端操作。<br>`$(document).ready(function() {   $(“#address1_stateorprovince”).val(“Saskatchewan”);});`|
|||

### <a name="entity-reference"></a>实体引用

以下参数与保存窗体时设置实体引用相关。

这提供了一种方法，用于将由窗体创建或更新的当前记录与其他目标记录相关联。 如果你有多个具有多个实体类型的步骤，并且想要关联生成的记录，或者如果向页面传递了你要关联的记录 id 的查询字符串，则这非常有用。 例如，我们有一个 "职业" 页，其中列出了作业发布，每个作业都有一个链接，指向作业的应用程序，该作业包含发布到应用程序窗体的作业的 id，因此，在创建应用程序时，作业发布与记录相关联。 

|名称|描述|
|-----|---------|
|保存时设置实体引用|是或否。 如果值为 "是"，则指示在保存窗体时应分配一个实体引用，否则将不会设置任何值。|
|关系名称|两个实体类型之间给定关系的关系定义名称。|
|实体逻辑名称|引用实体的逻辑名称。|
|目标查找属性逻辑名称|正在创建或更新的目标实体上的查找属性的逻辑名称。|
|填充查找字段| 如果对引用实体的查找在窗体上，则选中此值将使用以下设置来填充窗体上的字段。|
|引用实体源类型|  以下值之一：<ul><li>查询字符串</li><li>当前门户用户</li><li>上一步的结果</li></ul> 选择_查询字符串_需要参数名称，该名称必须在表单的 URL 的查询字符串中提供。 这可以在 "**查询字符串名称**" 字段中指定。 如果此参数为主键，则选择 "是" 作为**查询字符串的主键**，否则选择 "否"，并提供目标实体上的属性的逻辑名称，以在 "**查询属性逻辑名称**" 字段中指定进行查询。  选择 "当前门户用户" 将检索当前已经过身份验证的用户的联系人记录。 选择 "上一步" 中的 "结果" 将检索在当前步骤之前或基于与实体源步骤相关联的步骤的特定步骤中创建的记录。|
|引用实体步骤| 用于检索在该步骤中创建或编辑的实体的前一步骤的 Web 窗体步骤记录，以将其与此当前步骤的记录相关联。|
|查询字符串名称| 在包含 Web 窗体的网页的 URL 的查询字符串中提供的参数名称。|
|查询字符串为主键|   "是" 表示查询字符串值为主键值。 "否" 表示查询字符串值是主键之外的属性类型。|
|查询属性逻辑名称|  用于查询记录的属性的逻辑名称。|
|显示 ReadOnly 详细信息| 指示窗体应呈现在页面顶部，显示有关引用记录的只读信息。 要求使用窗体名称。|
|窗体名称| 引用实体上用于显示只读详细信息的窗体的名称。|
|||


## <a name="entity-form-action-configuration"></a>实体窗体操作配置

默认情况下，实体窗体将允许读取或更新现有记录，或插入新记录。  不过，您也可以轻松地为实体窗体中的记录启用和配置其他操作（删除、激活、停用等）。 如果启用了操作，还可以覆盖默认标签、大小和将显示的其他属性。

可在实体窗体的 "**其他设置**" 部分找到这些设置。 默认情况下，仅显示**基本设置**。 你可以选择 "**高级设置**" 以显示其他设置。

您可以为适用于单个记录的操作添加操作按钮，并将为网格中的每一行显示该操作按钮，前提是[实体权限](assign-entity-permissions.md)授予了相应的权限。 以下操作可用：

- Delete
- Workflow
- 创建相关记录
- 启用
- 禁止

单击其中一个选项将显示该操作的配置区域。 此外，某些实体具有特定的操作，这些操作可用于每个实体：

- 计算机会值（机会）
- 取消案例操作（事件）
- 关闭（解决） Case 操作（事件）
- 将引号转换为 Order （Quote）
- 将订单转换为发票（salesorder）
- 从机会生成报价单（机会）
- 失去机会操作（机会）
- Win 机会操作（机会）
- 重新打开 Case 操作（事件）
- 设置保持机会（机会）

> [!NOTE]
> 建议创建一个工作流，而不是为已定义其业务流程所需的特定**状态**和**状态代码**值的现成实体添加 "**激活**" 或 "**停用**" 按钮。 例如，事件（[状态选项](https://docs.microsoft.com/dynamics365/customerengagement/on-premises/developer/entities/incident#statuscode-options)）、机会（[状态](https://docs.microsoft.com/dynamics365/customerengagement/on-premises/developer/entities/opportunity#statuscode-options)选项）、权利（[状态选项](https://docs.microsoft.com/dynamics365/customerengagement/on-premises/developer/entities/entitlement#statuscode-options)）。 


## <a name="geolocation-configuration-for-entity-forms"></a>实体窗体的地理位置配置

可以将托管窗体配置为显示地图控件，以将现有位置显示为地图上的 pin，或提供用户指定位置的功能。 请参阅[添加地理位置](add-geolocation.md)。

窗体的地图控件需要其他配置，以告诉它各种位置字段的 Id 是什么、向其分配值或从中检索值。 实体窗体记录包含一个配置节，该配置节定义必须指定的这些字段映射。 字段名称会因创建的架构而异。

![实体窗体中的地理位置数据](../media/geolocation-managed-form.png "实体窗体中的地理位置数据") 

> [!Note]
> - 启用地理位置后，只读实体窗体中的 "地址" 字段将替换为地图。
> - "地理位置" 部分在德语主权云环境中不可见。 如果用户使用不同的格式启用了地理位置，则在门户中呈现时不会显示此位置。

### <a name="see-also"></a>另请参阅

[配置门户](configure-portal.md)  
[门户的 Web 窗体属性](web-form-properties.md)  
[门户的 Web 窗体步骤](web-form-steps.md)  
[门户的 Web 窗体元数据](configure-web-form-metadata.md)  
[门户的 Web 窗体子网格配置](configure-web-form-subgrid.md)  
[门户的实体窗体和 Web 窗体的说明配置](../configure-notes.md)
