---
title: 定义实体窗体 | MicrosoftDocs
description: 有关如何在门户中创建实体窗体的说明。
author: tapanm-msft
manager: kvivek
ms.service: powerapps
ms.topic: conceptual
ms.custom: ''
ms.date: 04/09/2020
ms.author: tapanm
ms.reviewer: ''
ms.openlocfilehash: 4ddc8daba01d281a483d51b1ce7a42205d0c6e93
ms.sourcegitcommit: 2484ebce6563cfd1c849e1e2f66dd2d29fdb7b64
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/10/2020
ms.locfileid: "3256667"
---
# <a name="about-entity-forms"></a>关于实体窗体

数据驱动的配置，供最终用户在门户中添加窗体以收集数据，同时无需开发人员在门户中显示此窗体，而实体窗体将在 Common Data Service 中创建，然后放入门户中的网页，或与子网格和实体列表一起使用来增建完整的 Web 应用程序。 [!INCLUDE[proc-more-information](../../../includes/proc-more-information.md)] [关于实体列表](entity-lists.md) 

![“联系我们”窗体](../media/contact-us-form.png "“联系我们”窗体")  

## <a name="add-a-form-to-your-portal"></a>向您的门户添加窗体

实体窗体包含与网页的关系和其他属性以控制门户中窗体的初始化。 与网页的关系允许对网站内指定页面节点的窗体定义进行动态检索。 

若要查看现有的实体窗体或创建新实体窗体，打开[门户管理应用](configure-portal.md)，转至**门户** &gt; **实体窗体**。

在创建新的实体窗体时第一步是确定您将呈现的**实体**和**窗体名称**，以及**模式：插入、编辑或只读**。 所选模式将确定您是从门户创建新记录，编辑现有记录还是只是在门户中显示与记录有关的信息。

> [!Note]
> - **实体窗体**必须与窗体的指定网站的网页关联才可在网站中查看。
> - 实体窗格中不支持连接实体子网格。 如果使用窗体设计器向窗体添加连接实体子网格，在门户中显示该窗体并使用连接实体时，将显示错误消息。
> - 重复字段、多选选项集、自定义控件、参与方列表字段和业务规则在实体窗体中不支持。
> - 业务规则和客户端 API 可在只读窗体上启用锁定字段。
> - 如果在“插入”模式下创建实体窗体，则不能更改按钮的对齐方式或在实体窗体上方放置操作按钮。
> - 如果在窗体上将查找控件呈现为下拉列表，则相关记录筛选器将不工作。

与实体窗体关联的网页可通过选择左侧菜单中的**相关**导航链接中所列的**网页**链接进行查看。

在创建或编辑网页时，**实体窗体**可在网页窗体中提供的查找字段中指定。

门户使用的各个主页包含 **EntityForm** 服务器控件的说明。 当呈现包含页面 (~/Pages/Page.aspx) 页面模板或整页 (~/Pages/FullPage.aspx) 页面模板时，控件将确定实体窗体查找是否包含值，如果包含，将呈现窗体。

## <a name="secure-your-forms"></a>保护您的窗体

若要保护您的窗体，必须根据 Web 角色创建确定记录访问权限和所有权的实体权限。 如果用户登录实体窗体，但不具有权限，他们将收到错误消息。 若要为实体窗体启用权限，请将**启用实体权限**设置为 true。 [!INCLUDE[proc-more-information](../../../includes/proc-more-information.md)] [为门户创建 Web 角色](create-web-roles.md)。  

## <a name="entity-form-attributes-and-relationships"></a>实体窗体属性和关系

|姓名|说明|
|-----|----------|
|姓名|记录的描述性名称。 此字段为必填字段。|
|实体名称|窗体将从中加载的实体的名称。 此字段为必填字段。|
|窗体名称|    要呈现的目标实体中的窗体的名称。 此字段为必填字段。|
|选项卡名称|    要呈现的指定实体的窗体中的选项卡的可选名称。|
|模式|以下值之一<ul><li>插入键</li><li>编辑​​</li><li>ReadOnly</li></ul>选择_插入_指示窗体应在提交后插入新记录。 指定_编辑_指示窗体应编辑记录。 选择_只读_指示窗体应显示现有记录的不可编辑窗体。 _编辑_和_只读_需要记录存在并且在“记录源类型”和“记录 ID 查询字符串参数名称”字段中指定参数以当窗体在门户中加载时选择相应的记录。|
|记录源类型|以下值之一<ul><li>查询字符串</li><li>当前门户用户</li><li>与当前门户用户关联的记录</li></ul>选择_查询字符串_需要必须在窗体 URL 的查询字符串中提供的参数名称。 这可以在“记录 ID 查询字符串参数名称”字段中指定。<br>选择_当前门户用户_将检索当前通过身份验证的用户的门户用户 记录。<br>选择_与当前门户用户关联的记录_将检索当前经过身份验证的用户的门户用户记录，然后检索“关系名称”字段指定的给定关系的记录。|
|记录 ID 查询字符串参数名称|    在包含该实体窗体的网页 URL 的查询字符串中提供的参数名称。|
|关系名称|    当记录源类型是与当前门户用户关联的记录时需要。 当前门户用户记录和目标记录之间的关系的逻辑名称。 这必须返回该实体名称字段指定的相同实体类型。|
|如果为空允许创建|    当记录源类型为与当前门户用户关联的记录时可用的可选布尔值。 指示如果相关记录不存在，允许用户第一次创建它，否则记录不存在将引发异常，因为窗体需要一个绑定数据的记录。|
|启用实体权限|    将导致窗体考虑实体权限。 默认为向后兼容原因是 False。 如果设置为 True，要访问窗体的所有用户都需要具有显式权限。|
|||

### <a name="form-options"></a>窗体选项

|姓名|说明|
|----|---------|
|添加 Captcha|    显示 captcha。|
|对已通过身份验证的用户显示 Captcha|    对已通过身份验证的用户显示 captcha。|
|验证组|    分派给用于评估已命名组的有效输入的输入控件的组名称。|
|从选项卡自动生成步骤|    指示在实体窗体中将显示多个选项，每个选项卡作为从第一个选项卡开始的顺序步骤，并继续直到所有选项卡导航到，并在最后提交后插入记录。 默认情况下不选择。 默认值指示只有一个选项卡或窗体为当前步骤呈现。 如果选项卡名称未指定，则第一个选项卡将显示。|
|内联呈现 Web 资源|    清除在实体窗体中包含 Web 资源的 iframe。|
|已启用工具提示|    使用目标实体的属性的说明设置工具提示。|
|显示不支持的字段|    当前支持所有字段。 这为 Common Data Service 可能对字段类型进行的可能更改保留。|
|将建议的字段设置为必填|     让所有属性都需要将字段需求级别设置为“建议的业务”。|
|让所有字段都是必填字段|     让所有字段都是必填字段，不论需求级别如何。|
|验证摘要 CSS 类|    分派给验证汇总的 CSS 类名称。 默认是“验证汇总警报警报错误警报阻止”|
|启用验证汇总链接|    布尔值为 true 或 false 指示锚点链接是否应在验证汇总中呈现以滚动到包含错误的字段。 默认值为 true。|
|验证汇总链接文本|    分派给验证汇总链接的标签。 默认值为“单击此处”。|
|验证摘要标题文本|    分派给验证摘要标题的标签。|
|说明|    窗体使用说明。|
|找不到记录消息|    要在没有找到记录时显示的消息。|
|||

### <a name="on-success-settings"></a>成功时设置

|姓名|说明|
|----|----------|
|成功时|    以下值之一<ul><li>显示成功消息（默认）</li><li>重定向</li></ul>|
|成功时隐藏窗体|    需要将“成功时”设置为“显示成功消息”。 如果选择，窗体将在成功提交窗体后隐藏。|
|“成功”消息|    需要将“成功时”设置为“显示成功消息”。 成功提交后向用户显示的消息。 如果消息未指定，默认消息（提交已成功完成）将显示。 对于为组织安装和启用的每种语言包，将提供一个字段用以使用相关语言输入消息。|
|外部 URL|需要对重定向进行操作成功设置。 指定 Web 中外部资源的 URL。
|或网页|需要对重定向进行操作成功设置。 从当前网站中选择网页。|
|追加现有查询字符串|    需要对重定向进行操作成功设置。 选择后，现有查询字符串参数将在重定向之前添加到目标 URL。|
|将记录 ID 追加到查询字符串|     需要对重定向进行操作成功设置。 选择后，创建的记录 ID 将追加到重定向到的 URL 的查询字符串。|
|记录 ID 查询字符串参数名称|     需要对重定向进行操作成功设置。 重定向到的 URL 的查询字符串中 ID 参数的名称。|
|追加自定义查询字符串|    需要对重定向进行操作成功设置。 可追加到重定向 URL 的现有查询字符串的自定义字符串。|
|将属性值追加到查询字符串 - 参数名称|    需要对重定向进行操作成功设置。 给予与目标实体中属性值相关的参数的名称，该实体追加到重定向 URL 的查询字符串。|
|向查询字符串追加属性值 - 属性逻辑名称|需要对重定向进行操作成功设置。 将值追加到重定向 URL 的查询字符串的目标实体中属性的逻辑名称。|
|||

### <a name="additional-settings"></a>其他设置

|姓名|说明|
|----|----------|
|关联当前门户用户|    指示当前登录的用户的记录应与目标实体记录关联。|
|目标实体门户用户查找属性|    存储门户用户的目标实体的属性的逻辑名称。|
|是活动方|    布尔值指示目标实体门户用户查找属性是否属于活动方类型。|
|附加文件 |  选择以使窗体在窗体底部包括文件上载控件以允许将文件附加到记录。 <br> **注意**：具有[版本 9.2.2.x 及更高版本](https://support.microsoft.com/help/4541765/power-apps-portals-version-9-2-2-x-release)的门户不需要在实体实体上启用**启用实体权限**来附加文件。 但是，如果选择此项，则必须确保在父实体和注释实体上提供了适当的特权，以在窗体上显示**附加文件**按钮。 注释实体必须至少具有**创建**和**追加**权限，父实体必须具有相应的**追加到**权限。 根据您是具有创建窗体还是更新窗体，您可能还需要**创建**、**读取**和**写入**权限才能完成窗体的方案。 |
|附加文件 - 存储位置|    选项：注释附件、Azure Blob 存储。 如果您的组织被配置为使用 Azure 存储，您可以选择在那里存储此实体窗体的上传文件。 否则，文件将存储为注释附件。|
|允许多个文件|指示用户是否可以上载多个文件的布尔值。|
|接受|    接受属性指定服务器通过文件上载接受的 MIME 文件类型。 若要指定多个值，请以逗号分隔值（例如，audio/*,video/*,image/*）。|
|标签|    在文件上载控件旁边显示的文本。 对于为组织安装和启用的每种语言包，将提供一个字段用以使用相关语言输入消息。|
|附加文件 - 必需| 让需要的文件附件继续执行。|
|需要错误消息|如果“需要”为 true 且用户尚未附加文件，在窗体验证期间显示的消息。 对于为组织安装和启用的每种语言包，将提供一个字段用以使用相关语言输入消息。|
|将文件限制为接受的类型|    强制对“接受”字段进行验证。 如果未选择，“接受”属性将仅用作文件上传对话框的建议。|
|“文件类型”错误消息|如果“将文件限制为接受的类型”为 true 并且用户尝试了上传无效文件类型，将在窗体验证期间显示的消息。 对于为组织安装和启用的每种语言包，将提供一个字段用以使用相关语言输入消息。|
|最大文件大小(KB)|    强制对上传文件的最大大小进行验证。|
|“文件大小”错误消息|    如果“最大文件大小(KB)”为 true 并且用户尝试了上传过大的文件，将在窗体验证期间显示的消息。 对于为组织安装和启用的每种语言包，将提供一个字段用以使用相关语言输入消息。|
|自定义 JavaScript|    将在关闭窗体标记元素前添加到页面底部的自定义 JavaScript 块。 实体字段的 HTML 输入 ID 设置为属性的逻辑名称。 这通过使用 jQuery 让选择字段、设置或其他客户端操作变得轻松。<br>`$(document).ready(function() {   $("#address1_stateorprovince").val("Saskatchewan");});`|
|||

### <a name="entity-reference"></a>实体引用

以下参数适合设置保存窗体时的实体引用。

这提供了将正在创建的当前记录或窗体更新的当前记录与其他目标记录关联的方法。 如果您的多个实体类型有多个步骤并希望关联结果记录，或如果页面被传送给您希望关联的记录 ID 的查询字符串，这非常有用。 例如，我们有一个列出职位公告的招聘页面，每个职位公告有一个指向包含申请表的职位公告的 ID 的工作的申请链接，这样，当创建应用程序时，职位公告将与记录关联。 

|客户|说明|
|-----|---------|
|设置保存时的实体引用|是或否。 值“是”指示当保存窗体时应分派实体引用，否则任何内容不会设置。|
|关系名称|两个实体类型之间指定关系的关系定义名称。|
|实体逻辑名称|引用实体的逻辑名称。|
|目标查找属性逻辑名称|创建或更新的目标实体的查找属性的逻辑名称。|
|填充查找字段|    如果有关引用实体的查找在窗体中，选中此值将在窗体的字段中填充使用以下设置检索的值。|
|引用实体源类型|    以下值之一<ul><li>查询字符串</li><li>当前门户用户</li><li>先前步骤的结果</li></ul> 选择_查询字符串_需要必须在窗体 URL 的查询字符串中提供的参数名称。 这可以在**查询字符串名称**字段中指定。 如果此参数是主键，那么为**查询字符串是主键**选择“是”，否则选择“否”，并在目标实体中为在**查询属性逻辑名称**字段中指定的查询提供属性的逻辑名称。  选择当前门户用户将检索当前通过身份验证的用户的联系人记录。 选择先前步骤的结果将检索在当前步骤前作为步骤结果创建的记录，或从基于与实体源步骤关联的步骤的特定步骤中创建的记录。|
|引用实体步骤|    先前步骤的 Web 窗体步骤记录用以检查在该步骤中创建或编辑的实体，以将它与当前步骤的记录关联。|
|查询字符串名称|    在包含该 Web 窗体的网页 URL 的查询字符串中提供的参数名称。|
|查询字符串是主键|    “是”指示查询字符串值是主键值。 “否”指示查询字符串值是除主键以外的属性类型。|
|查询属性逻辑名称|    要查询记录的属性的逻辑名称。|
|显示 ReadOnly 详细信息|    指示应在显示关于引用记录的只读信息的页面顶部呈现窗体。 需要窗体名称。|
|窗体名称|    应该用于显示只读详细信息的引用实体中的窗体的名称。|
|||


## <a name="entity-form-action-configuration"></a>实体窗体操作配置

默认情况下，实体窗体将允许读取或更新现有记录，或插入新记录。  不过，您也可以为实体窗体中的记录轻松启用和配置其他操作（删除、激活、停用等）。 还可以替代默认标签、大小以及在已启用操作时显示的其他属性。

这些设置位于实体窗体的**其他设置**部分中。 默认情况下，仅显示**基本设置**。 您可以选择**高级设置**来查看更多设置。

您可以为适用于单个记录并将为网格中的每行显示的操作添加操作按钮（如果[实体权限](assign-entity-permissions.md)已授予适宜的权限）。 可执行以下操作：

- 删除
- 工作流
- 创建相关记录
- 激活
- 停用

单击以下选项之一将显示该操作的配置区域。 此外，可按实体为某些实体提供特殊操作：

- 计算商机的价值（商机）
- 取消案例操作（事件）
- 结束（解决）案例操作（事件）
- 将报价单转换为订单（报价单）
- 将订单转换为发票（销售订单）
- 从商机生成报价单（商机）
- 丢单操作（商机）
- 赢单操作（商机）
- 重开案例操作（事件）
- 将商机设置为暂候（商机）

> [!NOTE]
> 建议已为其业务流程定义了所需的特定**状态**和**状态代码**值的现成实体创建工作流，而不是添加**激活**或**停用**按钮。 例如，事件（[状态选项](https://docs.microsoft.com/dynamics365/customerengagement/on-premises/developer/entities/incident#statuscode-options)）、商机（[状态选项](https://docs.microsoft.com/dynamics365/customerengagement/on-premises/developer/entities/opportunity#statuscode-options)）、权利（[状态选项](https://docs.microsoft.com/dynamics365/customerengagement/on-premises/developer/entities/entitlement#statuscode-options)）。 


## <a name="geolocation-configuration-for-entity-forms"></a>实体窗体的地理位置配置

托管窗体可以进行配置以显示一个地图控件，用于显示地图上的图钉的现有位置或使用户可以指定一个位置。 请参阅[添加地理位置](add-geolocation.md)。

窗体地图控件需要额外配置才能告知它不同位置字段的 ID 以向它们分派值或检索来自它们的值。 实体窗体记录有一个定义您必须指定的这些字段映射的配置部分。 字段名称根据您创建的架构而有所不同。

![实体窗体中的地理位置数据](../media/geolocation-managed-form.png "实体窗体中的地理位置数据") 

> [!Note]
> - 当启用地理位置时将只读实体窗体中的地址字段更换为地图。
> - 地理位置部分在德国 Sovereign 云环境中不显示。 如果用户使用不同窗体启用地理位置，在门户上呈现时不会显示。

## <a name="request-validation"></a>请求验证

[请求验证](https://docs.microsoft.com/aspnet/whitepapers/request-validation)是 ASP.NET 自版本 1.1 开始提供的一项功能，可防止服务器接受包含未编码的 HTML 的内容。 此功能的目的是帮助防止一些脚本注入攻击，在这种情况下，会将客户端脚本代码或 HTML 不知不觉地提交到服务器、存储，然后向其他用户提供。 我们仍强烈建议您验证所有输入数据，并在适当时对其进行 HTML 编码。

默认情况下，如果您在实体窗体字段中输入了未进行 HTML 编码的脚本代码，则会在门户网站上启用请求验证，从而导致以下一般性错误：

![请求验证错误](../media/request-validation-error.png)

若要禁用请求验证，请执行下列步骤：

1. 转到[门户设置](https://docs.microsoft.com/powerapps/maker/portals/manage-existing-portals#settings)，选择**站点设置**。

1. 选择**新建**。

1. 键入名称 **DisableValidationWebTemplate**。

1. 选择相应的网站记录。

1. 键入值**真**。 默认情况下，设置为**假**以启用请求验证。

1. 键入适当的说明。

1. 选择**保存并关闭**。

> [!CAUTION]
> 当禁用请求验证后，内容可以提交到页面。 您必须确保正确地对内容进行了编码或处理。

### <a name="see-also"></a>另请参阅

[配置门户](configure-portal.md)  
[门户的 Web 窗体属性](web-form-properties.md)  
[门户的 Web 窗体步骤](web-form-steps.md)  
[门户的 Web 窗体元数据](configure-web-form-metadata.md)  
[门户的 Web 窗体子网格配置](configure-web-form-subgrid.md)  
[门户的实体窗体和 Web 窗体的注释配置](../configure-notes.md)
