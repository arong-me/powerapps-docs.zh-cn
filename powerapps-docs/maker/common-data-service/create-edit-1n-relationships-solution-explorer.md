---
title: 使用解决方案资源管理器创建和编辑 1:N（一对多）或 N:1（多对一）实体关系 | MicrosoftDocs
description: 了解如何使用 PowerApps 解决方案资源管理器创建一对多或多对一实体关系
ms.custom: ''
ms.date: 10/28/2018
ms.reviewer: ''
ms.service: powerapps
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
applies_to:
- Dynamics 365 (online)
- Dynamics 365 Version 9.x
- powerapps
author: Mattp123
ms.author: matp
manager: kvivek
search.audienceType:
- maker
search.app:
- PowerApps
- D365CE
ms.openlocfilehash: 3488b8228841f7b5323daee972472884e7c873d8
ms.sourcegitcommit: d9cecdd5a35279d78aa1b6c9fc642e36a4e4612c
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/04/2019
ms.locfileid: "2758136"
---
# <a name="create-and-edit-1n-one-to-many-or-n1-many-to-one-entity-relationships-using-solution-explorer"></a>使用解决方案资源管理器创建和编辑 1:N（一对多）或 N:1（多对一）实体关系 

解决方案资源管理器提供了一个为 Common Data Service 创建和编辑 1:N（一对多）或 N:1（多对一）实体关系的方法。

[PowerApps 门户](https://make.powerapps.com/?utm_source=padocs&utm_medium=linkinadoc&utm_campaign=referralsfromdoc)支持配置最常见的选项，但是某些选项只能使用解决方案资源管理器设置。 详细信息： 
- [创建 1:N（一对多）或 N:1（多对一）关系](create-edit-1n-relationships.md)
- [在 PowerApps 门户中创建和编辑 1:N（一对多）或 N:1（多对一）实体关系](create-edit-1n-relationships-portal.md)
  
## <a name="open-solution-explorer"></a>打开解决方案资源管理器

您创建的任何自定义关系的名称中都包含自定义前缀。 这是根据您在其中工作的解决方案的解决方案发布商设置的。 如果您关心自定义前缀，请确保在非托管解决方案中工作，其中的自定义前缀是您需要的此实体的前缀。 详细信息：[更改解决方案发布商前缀](change-solution-publisher-prefix.md) 

[!INCLUDE [cc_navigate-solution-from-powerapps-portal](../../includes/cc_navigate-solution-from-powerapps-portal.md)]

## <a name="view-entity-relationships"></a>查看实体关系

在解决方案资源管理器中，展开**实体**并选择一个实体。 在该实体内，选择 **1:N 关系**或 **N:1 关系**

![查看实体关系](media/view-1n-entity-relationships-solution-explorer.png)

## <a name="create-relationships"></a>创建关系

在[查看实体关系](#view-entity-relationships)时，从命令栏选择**新建一对多关系**或**新建多对一关系**。

> [!NOTE]
> 如果命令不可用，实体则没有资格创建自定义关系。

任何选项都将打开一个窗体，如下所示。 区别在于是否设置**主要实体**或**相关实体**字段。

![“新建一对多关系”窗体](media/new-1n-entity-relationship-form-solution-explorer.png)

- 通过 **1:N 关系**，**主要实体**被设置为当前实体
- 通过 **N:1 关系**，**相关实体**被设置为当前实体

必须设置以下字段来保存实体关系：

|必填字段|说明|
|--|--|
|**主要实体**|此实体将是在相关实体上创建的查找字段的目标类型。|
|**相关实体**|此实体将添加一个查找字段来关联实体记录与主要实体记录。|
|**名称**|关系的名称。 一个值将基于主要和相关实体值生成。 此字段将添加解决方案发布商的自定义前缀。|
|**查找字段显示名称**|将为相关实体创建的查找字段的可本地化文本。 这通常与主要实体的显示名称相同。 <br /> 以后可以更改此信息。|
|**查找字段名称**|将在相关实体上创建的查找字段的名称。 一个值将基于**查找字段显示名称**生成。 此字段将添加解决方案发布商的自定义前缀。|

您可以单击![“保存实体关系”按钮](media/save-entity-icon-solution-explorer.png)来保存实体并继续编辑。 详细信息：[编辑关系](#edit-relationships)

> [!NOTE]
> 如果**名称**或**查找字段名称**值在系统中已经存在，在您保存时将会收到错误消息。 编辑值使其是唯一值，然后重试。

## <a name="edit-relationships"></a>编辑关系

在[查看实体关系](#view-entity-relationships)时，选择要编辑的实体。 在创建关系后，可以编辑以下关系属性。

> [!NOTE]
> 托管解决方案的发布商可以阻止其解决方案一部分的一些关系的自定义。

### <a name="entity-relationship-properties"></a>实体关系属性

这些属性与此关系有关。

|字段|说明|
|--|--|
|**可搜索**|此关系是否应在模型驱动应用程序中的“高级查找”中可见。 如果这是一个对您的业务不重要的关系，选择**否**。|
|**分层**|此选项仅对自引用关系启用。 定义实体的层次结构是否应考虑此实体。<br />**重要提示**：在设置此属性后，汇总字段、流程和视图可以根据此属性配置。 如果以后更改此值，依赖层次结构的功能将不工作。 <br />详细信息：[定义和查询层次上相关的数据](define-query-hierarchical-data.md)|

### <a name="lookup-field"></a>查找字段

这些是在相关实体上创建的查找字段的属性。 这些属性可以在此处编辑或通过直接编辑查找字段编辑。 有些字段属性不能从关系编辑。 详细信息：[编辑字段](create-edit-field-solution-explorer.md#edit-a-field)

|字段|说明|
|--|--|
|**显示名称**|将为相关实体创建的查找字段的可本地化文本。|
|**字段要求**|字段是否必须包含数据，然后才能保存模型驱动应用程序中的窗体。 详细信息：[字段要求选项](create-edit-field-solution-explorer.md#field-requirement-options)|
|**说明**|为用户输入有关字段用途的说明。 当用户将鼠标悬停在字段的标签上时，这些描述在模型驱动应用程序中显示为用户的工具提示。|

### <a name="navigation-pane-item-for-primary-entity"></a>主要实体的导航窗格项

从主要实体可以导航以查看相关记录。 此数据由模型驱动应用程序用于控制相关实体记录如何显示。 还可以使用窗体编辑器编辑这些设置。

|字段|说明|
|--|--|
|**显示选项**|相关实体列表应如何显示。 详细信息：[显示选项](#display-options)|
|**自定义标签**|在选择**使用自定义标签**作为**显示选项**时，请指定要使用的可本地化文本而不是复数名称。|
|**显示区域**|选择用于显示此列表的一个可用分组。 可用选项包括：**详细信息**（对于*公用*组）、**市场营销**、**销售**和**服务**。 |
|**显示顺序**|控制导航项在所选显示区域中的位置。 允许的数字范围从 10,000 开始。 具有较低值的导航窗格项出现在具有较高值的其他关系上方。|

<!-- TODO: Not sure whether Display Area or Display Order are still used anymore. Might only be used in the Outlook client?-->

#### <a name="display-options"></a>显示选项

这些是可用显示选项：

|选项|说明|
|--|--|
|**不显示**|不显示此关系的相关实体。|
|**使用自定义标签**|在选择此选项时，**自定义标签**字段将启用，以便您可以指定要使用的可本地化文本，而不是复数名称。|
|**使用复数名称**|使用为相关实体定义的复数显示名称。|

### <a name="relationship-behavior"></a>关系行为

这是可以定义相关实体的标准行为的位置。 此信息非常重要，因为它有助于确保数据完整性，并可以让您公司的业务流程实现自动化。

让我们看一个示例。  
  
假定您有一位新销售员，您希望向其分派一些当前分派给另一位销售员的现有商机。 每个商机记录可能有一些与其关联的任务活动。 您可以轻松地找到要重新分派的可用商机，并将其分派给新销售员。 但是，对于与这些商机关联的任何任务活动，会发生什么情况？ 您是否打开每项任务，并决定是否也应将其分派给新销售员？ 可能不需要。 您可以让关系自动应用一些标准规则。 这些规则只适用于与您要重新分派的商机关联的任务记录。 您的选择是：  
  
- 重新分派所有可用任务。  
- 重新分派所有任务。 
- 不重新分派任务。  
- 重新分派当前分派给前一个商机负责人的所有任务。  
  
关系可以控制对主要实体记录的记录执行的操作如何向下级联到所有相关实体记录。   

在进行某些操作时，有多个行为类型可以应用。

#### <a name="behaviors"></a>行为

这些是可以配置的行为。

|行为|说明|
|--|--|
|**可用项的级联**|对所有可用的相关实体记录执行操作。|
|**全部级联**|对所有相关实体记录执行操作。|
|**无级联**|不执行任何操作。|
|**移除链接**|删除所有相关记录的查找值。|
|**限制**|当存在相关实体记录时，阻止删除主要实体记录。|
|**用户负责项的级联**|对被主要实体记录的用户所负责的所有相关实体记录执行操作。|

#### <a name="actions"></a>操作

下面是可以触发特定行为的操作：

|字段|说明|Options|
|--|--|--|
|**分派**|当主要实体记录分配给其他人时，会发生什么情况？|全部级联<br />可用项的级联<br />用户负责项的级联<br />无级联|
|**重定父级**|在父关系中的相关实体的查找值发生更改时，会发生什么情况？<br />详细信息：[父实体关系](#parental-entity-relationships)|全部级联<br />可用项的级联<br />用户负责项的级联<br />无级联|
|**共享**|当主要实体记录共享时，会发生什么情况？|全部级联<br />可用项的级联<br />用户负责项的级联<br />无级联|
|**删除**|当删除主要实体记录时，会发生什么情况？|全部级联<br />移除链接<br />限制|
|**取消共享**|当主要实体记录不共享时，会发生什么情况？|全部级联<br />可用项的级联<br />用户负责项的级联<br />无级联|
|**合并**|当主要实体记录合并时，会发生什么情况？|全部级联<br />无级联|
|**汇总视图**|与此关系关联的汇总视图的预期行为是什么？ |全部级联<br />可用项的级联<br />用户负责项的级联<br />无级联|

<!-- TODO: I find no official docs related to rollup views, but plenty of hits online: https://www.google.com/search?q=Dynamics+365++%27rollup+view%27 -->



#### <a name="type-of-behavior-options"></a>行为类型选项

使用**行为类型**字段在标准行为集或是否单独配置它们之间进行选择。 

|选项|说明|
|--|--|
|**父**|**分配**：全部级联<br />**重定父级**：全部级联<br />**共享**：全部级联<br />**删除**：全部级联<br />**取消共享**：全部级联<br />**合并**：无级联<br />**汇总视图**：无级联\|全部级联<br />|
|**引用**|**分配**：无级联<br />**重定父级**：无级联<br />**共享**：无级联<br />**删除**：删除链接<br />**取消共享**：无级联<br />**合并**：无级联<br />**汇总视图**：无级联\|全部级联<br />|
|**引用，限制删除**|**分配**：无级联<br />**重定父级**：无级联<br />**共享**：无级联<br />**删除**：限制<br />**取消共享**：无级联<br />**合并**：无级联<br />**汇总视图**：无级联\|全部级联<br />|
|**可配置项的级联**|您可以根据可用选项为各项操作配置所需的行为|

> [!NOTE]
> 如果任一实体已经参与父实体关系，您可能无法选择**父**选项。 详细信息：[父实体关系](#parental-entity-relationships)
> 
> 如果您使用**可配置的级联**设置操作的行为，以使其匹配与其他**行为类型**关联的操作的行为，当保存关系时，**行为类型**将自动设置为匹配类型。  



## <a name="delete-relationships"></a>删除关系

在[查看实体关系](#view-entity-relationships)时，选择要删除的实体关系并单击![删除命令](media/delete.gif)命令。

删除关系将删除相关实体上的查找字段。

> [!NOTE]
> 您将无法删除具有依赖项的关系。 例如，如果已向相关实体的窗体添加了查找字段，则必须在删除关系前从窗体中删除字段。

## <a name="parental-entity-relationships"></a>父级实体关系

可以具有 1:N 关系的每对实体之间可以具有多个 1:N 关系。 但通常只能将其中一个关系视为父实体关系。

父实体关系是下表的**父**列中的级联选项之一为 true 的任何 1:N 实体关系。

|目的|父|非父|  
|------------|--------------|------------------|  
|**分派**|全部级联<br />用户负责项的级联<br />可用项的级联|无级联|  
|**删除**|全部级联|移除链接<br />限制|  
|**重定父级**|全部级联<br />用户负责项的级联<br />可用项的级联|无级联|  
|**共享**|全部级联<br />用户负责项的级联<br />可用项的级联|无级联|  
|**取消共享**|全部级联<br />用户负责项的级联<br />可用项的级联|无级联|  

例如，如果您新建一个自定义实体并添加与客户实体的 1:N 实体关系（其中自定义实体是相关实体），则可以将该实体关系的操作配置为使用**父**列中的选项。 如果您后来添加了自定义实体作为引用实体的另一个 1:N 实体关系，则只能将操作配置为使用**非父**列中的选项。

通常这意味着，对于每个实体对，只有一个父关系。 有些情况下，相关实体上的查找可能允许与多种类型的实体之间的关系。

例如，如果实体具有可以引用联系人或客户实体的“客户”查找。 有两个单独的父 1:N 实体关系。

对于可使用相关项查找字段进行关联的实体，任何活动实体都具有一组类似的父实体关系。

<a name="BKMK_RelationshipBehaviorLimitations"></a>   

### <a name="limitations-on-behaviors-you-can-set"></a>对可以设置的行为的限制
  
由于存在父关系，在定义实体关系时，应当记住一些限制。  
  
- 在有级联的相关系统实体的关系中，自定义实体不能为主要实体。 这表示在主要自定义实体和相关系统实体间不能与设置为**全部级联**、**可用项的级联**或**用户负责项的级联**的任何操作具有关系。  
- 如果新关系中的相关实体已作为其他关系（该其他关系具有设置为**全部级联**、**可用项的级联**或**用户负责项的级联**的任意操作）中的相关实体而存在，则任何新关系都不能具有设置为**全部级联**、**可用项的级联**或**用户负责项的级联**的任意操作。 这将防止创建具有多个父级的关系。  

### <a name="see-also"></a>另请参阅

[创建和编辑实体之间的关系](create-edit-entity-relationships.md)<br />
[创建和编辑 1:N（一对多）或 N:1（多对一）关系](create-edit-1n-relationships.md)<br />
[在 PowerApps 门户中创建和编辑 1:N（一对多）或 N:1（多对一）实体关系](create-edit-1n-relationships-portal.md)<br />
[创建 N:N（多对多）关系](create-edit-nn-relationships.md)

