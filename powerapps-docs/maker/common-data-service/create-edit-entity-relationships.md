---
title: Common Data Service 实体关系概述 | MicrosoftDocs
ms.custom: ''
ms.date: 04/25/2019
ms.reviewer: ''
ms.service: powerapps
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
applies_to:
- Dynamics 365 (online)
- Dynamics 365 Version 9.x
- PowerApps
ms.assetid: c765b6d9-4d87-4c2d-aae2-5b1c3b664a71
caps.latest.revision: 28
ms.author: matp
manager: kvivek
author: Mattp123
search.audienceType:
- maker
search.app:
- PowerApps
- D365CE
ms.openlocfilehash: 89a28060f7894afe49d0abe36b4461d6e2cbc474
ms.sourcegitcommit: 2b34de88c977c149e4c632b23d8e816901c15949
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 02/12/2020
ms.locfileid: "3040379"
---
# <a name="entity-relationships-overview"></a>实体关系概述
实体关系定义记录如何在数据库中相互关联。 最简单的情况是，向实体中添加查找字段将在两个实体之间形成一个新的 1:N（一对多）关系，并使您能够将该查找字段放在窗体中。 利用查找字段，用户可以将该实体的多个*子*记录与单个*父*实体记录关联。  
  
除了简单地定义记录如何相互关联以外，1:N 实体关系还提供可解决以下问题的数据：  
  
- 在删除某个记录时，是否还应删除与该记录相关的所有记录？  
- 分派记录时，是否还需将与该记录相关的所有记录分派给新负责人？  
- 在某个现有记录的上下亠中创建新的相关记录时，如何简化数据录入流程？  
- 查看某个记录的用户如何才能查看关联的记录？  
  
 实体还可以参与 N:N（多对多）关系，其中两个实体的任意数量的记录都可以彼此关联。  

<a name="BKMK_Connections"></a>

## <a name="decide-whether-to-use-entity-relationships-or-connections"></a>决定是使用实体关系还是连接 
实体关系是对数据库进行更改的元数据。 这些查询关系允许查询以便非常高效地检索相关数据。 使用实体关系可以定义能定义实体或者大多数记录可以使用的正式关系。 例如，没有潜在客户的商机不是非常有用。 “商机”实体还与“竞争对手”实体有 N:N 关系。 此使得可以将多个竞争添加到商机中。 您可能需要获取此数据，并创建显示竞争对手的报表。  
  
在称为*连接*的记录之间还存在其他不太正式的各种关系。 例如，了解两个联系人是否结婚，是工作外的朋友关系，或者是为另一个客户工作的联系人，可能会很有用。 大多数企业不会使用这种信息生成报表，或者要求输入此类信息，因此可能不值得创建实体关系。 详细信息：[配置连接角色](configure-connection-roles.md)

  
<a name="BKMK_TypesOfRelationships"></a>
 
## <a name="types-of-entity-relationships"></a>实体关系类型
在查看解决方案资源管理器时，可能会想到有三种类型的实体关系。 实际上，只有下表中所示的两种关系。  
  
|关系类型|说明|  
|-----------------------|-----------------|  
|**1:N（一对多）**|在这种实体关系中，**主要实体**的一个实体记录可以根据相关实体上的查找字段与多个其他**相关实体**记录关联。<br /><br /> 在查看主要实体记录时，可以看到与其关联的相关实体记录的列表。<br /><br /> 在 Power Apps 门户中，**当前实体**代表主要实体。|  
|**N:N（多对多）**|依赖于特殊**关系实体**（有时称为相交实体）的实体关系，使一个实体的多个记录可以与另一个实体的多个记录关联。<br /><br /> 在查看 N:N 关系中的任一实体的记录时，可以看到与其相关的另一个实体的所有记录的列表。|  
  
**N:1（多对一）** 关系类型存在于用户界面中，因为设计器会显示按实体分组的视图。 1:N 关系实际上存在于实体*之间*，并将每个实体称为**主要/当前实体**或**相关实体**。 相关实体（有时称为*子*实体）有一个查找字段，可用于存储对主要实体（有时称为*父*实体）中的记录的引用。 N:1 关系只是从相关实体角度来看的 1:N 关系。  
 
## <a name="entity-relationship-behavior"></a>实体关系行为
相关实体的行为非常重要，因为它有助于确保数据完整性，并可以让您公司的业务流程实现自动化。

### <a name="preserve-data-integrity"></a>保持数据完整性
某些实体的用途是为其他实体提供支持。 这些实体对自身无用。 它们通常有一个链接到所支持主实体的必需的查找字段。 当删除主记录时，会发生什么情况？

可使用关系行为根据业务的规则对此进行定义。 两个选项如下：

- 阻止删除主实体，以便可以协调相关实体记录，方法可以是将其与其他主实体关联。
- 允许在删除主实体记录时自动删除相关实体。

如果相关实体不支持主实体，可允许删除主实体，这样将清除查找值。

### <a name="automate-business-processes"></a>自动化业务流程
假定您有一位新销售员，您希望向其分派一些当前分派给另一位销售员的现有客户。 每个客户记录可能有一些与其关联的任务活动。 您可以轻松地找到要重新分派的可用客户，并将其分派给新销售员。 但是，对于与这些客户关联的任何任务活动，会发生什么情况？ 您是否打开每项任务，并决定是否也应将其分派给新销售员？ 可能不需要。 您可以让关系自动应用一些标准规则。 这些规则只适用于与您要重新分派的客户关联的任务记录。 您的选择是：  
  
- 重新分派所有可用任务。  
- 重新分派所有任务。 
- 不重新分派任务。  
- 重新分派当前分派给前一个客户负责人的所有任务。  
  
关系可以控制对主要实体记录的记录执行的操作如何向下级联到所有相关实体记录。  

### <a name="behaviors"></a>行为
在进行某些操作时，有多个行为类型可以应用。

|行为|说明|
|--|--|
|**可用项的级联**|对所有可用的相关实体记录执行操作。|
|**全部级联**|对所有相关实体记录执行操作。|
|**无级联**|不执行任何操作。|
|**移除链接**|删除所有相关记录的查找值。|
|**限制**|当存在相关实体记录时，阻止删除主要实体记录。|
|**用户负责项的级联**|对被主要实体记录的用户所负责的所有相关实体记录执行操作。|

### <a name="actions"></a>操作
下面是可以触发特定行为的操作：

|字段|说明|Options|
|--|--|--|
|**分派**|当主要实体记录分配给其他人时，会发生什么情况？|全部级联<br />可用项的级联<br />用户负责项的级联<br />无级联|
|**重定父级**|在父关系中的相关实体的查找值发生更改时，会发生什么情况？<br />详细信息：[父实体关系](#parental-entity-relationships)|全部级联<br />可用项的级联<br />用户负责项的级联<br />无级联|
|**共享**|当主要实体记录共享时，会发生什么情况？|全部级联<br />可用项的级联<br />用户负责项的级联<br />无级联|
|**删除**|当删除主要实体记录时，会发生什么情况？|全部级联<br />移除链接<br />限制|
|**取消共享**|当主要实体记录不共享时，会发生什么情况？|全部级联<br />可用项的级联<br />用户负责项的级联<br />无级联|
|**合并**|当主要实体记录合并时，会发生什么情况？|全部级联<br />无级联|
|**汇总视图**|与此关系关联的汇总视图的预期行为是什么？ |全部级联<br />可用项的级联<br />用户负责项的级联<br />无级联|

> [!NOTE]
> 在下列情况下，将不会执行分配、删除、合并和重定父级操作：
> - 如果原始父记录和请求的操作包含相同值。 示例：尝试触发分配和选择已是记录负责人的联系人
> - 尝试对已运行级联操作的父记录执行操作

> [!NOTE]
> 执行分配时，会在重新分配发生时自动停用记录上当前处于活动状态的工作流或业务规则。 如果记录的新负责人想要继续使用该工作流或业务规则，则需要将其重新激活。

### <a name="parental-entity-relationships"></a>父级实体关系
可以具有 1:N 关系的每对实体之间可以具有多个 1:N 关系。 但通常只能将其中一个关系视为父实体关系。

父实体关系是下表的**父**列中的级联选项之一为 true 的任何 1:N 实体关系。

|目的|父|非父|  
|------------|--------------|------------------|  
|**分派**|全部级联<br />用户负责项的级联<br />可用项的级联|无级联|  
|**删除**|全部级联|移除链接<br />限制|  
|**重定父级**|全部级联<br />用户负责项的级联<br />可用项的级联|无级联|  
|**共享**|全部级联<br />用户负责项的级联<br />可用项的级联|无级联|  
|**取消共享**|全部级联<br />用户负责项的级联<br />可用项的级联|无级联|  

例如，如果您新建一个自定义实体并添加与客户实体的 1:N 实体关系（其中自定义实体是相关实体），则可以将该实体关系的操作配置为使用**父**列中的选项。 如果您后来添加了自定义实体作为引用实体的另一个 1:N 实体关系，则只能将操作配置为使用**非父**列中的选项。

通常这意味着，对于每个实体对，只有一个父关系。 有些情况下，相关实体上的查找可能允许与多种类型的实体之间的关系。

例如，如果实体具有可以引用联系人或客户实体的“客户”查找。 有两个单独的父 1:N 实体关系。

对于可使用相关项查找字段进行关联的实体，任何活动实体都具有一组类似的父实体关系。

<a name="BKMK_RelationshipBehaviorLimitations"></a>   

### <a name="limitations-on-behaviors-you-can-set"></a>对可以设置的行为的限制
由于存在父关系，在定义实体关系时，应当记住一些限制。  
  
- 在有级联的相关系统实体的关系中，自定义实体不能为主要实体。 这表示在主要自定义实体和相关系统实体间不能与设置为**全部级联**、**可用项的级联**或**用户负责项的级联**的任何操作具有关系。  
- 如果新关系中的相关实体已作为其他关系（该其他关系具有设置为**全部级联**、**可用项的级联**或**用户负责项的级联**的任意操作）中的相关实体而存在，则任何新关系都不能具有设置为**全部级联**、**可用项的级联**或**用户负责项的级联**的任意操作。 这将防止创建具有多个父级的关系。  

### <a name="see-also"></a>另请参阅
[实体和元数据概述](create-edit-metadata.md)<br />
[创建和编辑 1:N（一对多）或 N:1（多对一）关系](create-edit-1n-relationships.md)<br />
[创建多对多 (N:N) 实体关系](create-edit-nn-relationships.md)

